%% compare different DMD
clear all;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           clear all;

dx = 0.01; x = 0:dx:1; x= x'; NX = length(x);
dt = dx; T = 0.8; t = 0:dt:T; NT = length(t);

u = zeros(NX,NT);
u(:,1) = 10*exp(-(x-0.5).^2*40);
% u(1,:) = 1;% u(end,:) = 1;

D = 0.1;
A = diag((1+2*D*dt/dx^2)*ones(NX,1))-diag(D*dt/dx^2*ones(NX-1,1),1)-diag(D*dt/dx^2*ones(NX-1,1),-1);
A(1,1) = 1; A(1,2) =0; A(end,end-1) = 0; A(end,end)=1;


for n = 1:NT-1
    u(:,n+1) = A\(u(:,n)+dt*x);
    u(1,n+1) = u(2,n+1);
    u(NX,n+1) = u(NX-1,n+1);
end

%%DMD
% X1 = u(:,1:end-1);
% X2 = u(:,2:end);
% A_dmd1 = X2*pinv(X1);
% u_dmd1 = 0*u;
% u_dmd1(:,1) = u(:,1);
% for n = 1:NT-1
%     u_dmd1(:,n+1) = A_dmd1*u_dmd1(:,n);
% end
X1 = u(:,1:end-1);
X2 = u(:,2:end);
[U,Sigma,V] = svd(X1);
index = find(diag(Sigma)<= sum(diag(Sigma))*1e-8);
k = min(index)
% k = rank(Sigma);
U_k = U(:,1:k); Sigma_k = Sigma(1:k,1:k); V_k = V(:,1:k);
A_dmd1 = X2*(V_k/Sigma_k*U_k');
u_dmd1 = 0*u;
u_dmd1(:,1) = u(:,1);
for n = 1:NT-1
    u_dmd1(:,n+1) = A_dmd1*u_dmd1(:,n);
end

%%DMD-id
% X1 = u(:,1:end-1);
% X2 = u(:,2:end);
% A_dmd2 = (X2-X1)*pinv(X1);
% u_dmd2 = 0*u;
% u_dmd2(:,1) = u(:,1);
% for n = 1:NT-1
%     u_dmd2(:,n+1) = u_dmd2(:,n)+A_dmd2*u_dmd2(:,n);
% end
X1 = u(:,1:end-1);
X2 = u(:,2:end);
[U,Sigma,V] = svd(X1);
index = find(diag(Sigma)<= sum(diag(Sigma))*1e-8);
k = min(index)
% k = rank(Sigma);
U_k = U(:,1:k); Sigma_k = Sigma(1:k,1:k); V_k = V(:,1:k);
A_dmd2 = (X2-X1)*(V_k/Sigma_k*U_k');
u_dmd2 = 0*u;
u_dmd2(:,1) = u(:,1);
for n = 1:NT-1
    u_dmd2(:,n+1) = u_dmd2(:,n)+A_dmd2*u_dmd2(:,n);
end

%% mDMD
% X1_tilde = [X1;ones(1,length(t)-1)];
% % X1_tilde(1,:) = 0; X1_tilde(end-1,:) = 0;
% Am1 = X2*pinv(X1_tilde);
% 
% u_dmd3 = 0*u;
% u_dmd3(:,1) = u(:,1);
% 
% for n = 1:NT-1
%     u_dmd3(:,n+1) = Am1*[u_dmd3(:,n);1];
% end

X1_tilde = [X1;ones(1,length(t)-1)];
% X1_tilde(1,:) = 0; X1_tilde(end-1,:) = 0;

[U,Sigma,V] = svd(X1_tilde);
index = find(diag(Sigma)<= sum(diag(Sigma))*1e-8);
k = min(index)
% k = rank(Sigma);
U_k = U(:,1:k); Sigma_k = Sigma(1:k,1:k); V_k = V(:,1:k);
Am1 = X2*(V_k/Sigma_k*U_k');

u_dmd3 = 0*u;
u_dmd3(:,1) = u(:,1);

for n = 1:NT-1
    u_dmd3(:,n+1) = Am1*[u_dmd3(:,n);1];
end

%% mDMD-id
% X1_tilde = [X1;ones(1,length(t)-1)];
% % X1_tilde(1,:) = 0; X1_tilde(end-1,:) = 0;
% Am2 = (X2-X1)*pinv(X1_tilde);
% 
% u_dmd4 = 0*u;
% u_dmd4(:,1) = u(:,1);
% 
% for n = 1:NT-1
%     u_dmd4(:,n+1) = u_dmd4(:,n)+Am2*[u_dmd4(:,n);1];
% end

X1_tilde = [X1;ones(1,length(t)-1)];
% X1_tilde(1,:) = 0; X1_tilde(end-1,:) = 0;
[U,Sigma,V] = svd(X1_tilde);
index = find(diag(Sigma)<= sum(diag(Sigma))*1e-8);
k = min(index)
% k = rank(Sigma);
U_k = U(:,1:k); Sigma_k = Sigma(1:k,1:k); V_k = V(:,1:k);
Am2 = (X2-X1)*(V_k/Sigma_k*U_k');
u_dmd4 = 0*u;
u_dmd4(:,1) = u(:,1);

for n = 1:NT-1
    u_dmd4(:,n+1) = u_dmd4(:,n)+Am2*[u_dmd4(:,n);1];
end




figure
width = 3.3;     % Width in inches
height = 2.2;    % Height in inches
set(gcf,'InvertHardcopy','on');
set(gcf,'PaperUnits', 'inches');
papersize = get(gcf, 'PaperSize');
left = (papersize(1)- width)/2;
bottom = (papersize(2)- height)/2;
myfiguresize = [left, bottom, width, height];
set(gcf,'PaperPosition', myfiguresize);
hold on;
plot(t,log10(sum((u-u_dmd1).^2,1)./sum(u.^2,1)),'k-','LineWidth',1);
plot(t,log10(sum((u-u_dmd2).^2,1)./sum(u.^2,1)),'g.','LineWidth',1);
plot(t,log10(sum((u-u_dmd3).^2,1)./sum(u.^2,1)),'b--','LineWidth',1);
plot(t,log10(sum((u-u_dmd4).^2,1)./sum(u.^2,1)),'r-.','LineWidth',1);
xlabel('$t$','FontUnits','points','interpreter','latex',...
    'FontSize',10);
ylabel('log relative error','FontUnits','points','interpreter','latex',...
    'FontSize',10);
legend({'DMD','rDMD','gDMD','xDMD'},'FontUnits','points','interpreter','latex',...
    'FontSize',10,'Location','Best');
legend('boxoff') 
title('Representation Error','FontUnits','points','interpreter','latex',...
    'FontSize',10);
% ylim([-17,-2])



% figure
% width = 3.3;     % Width in inches
% height = 2.2;    % Height in inches
% set(gcf,'InvertHardcopy','on');
% set(gcf,'PaperUnits', 'inches');
% papersize = get(gcf, 'PaperSize');
% left = (papersize(1)- width)/2;
% bottom = (papersize(2)- height)/2;
% myfiguresize = [left, bottom, width, height];
% set(gcf,'PaperPosition', myfiguresize);
% hold on;
% plot(x,u(:,41),'b-','LineWidth',1);
% plot(x(1:5:end),u_dmd1(1:5:end,41),'bo','Markersize',3);
% plot(x(1:5:end),u_dmd4(1:5:end,41),'bx','Markersize',3);
% plot(x,u(:,81),'r-','LineWidth',1);
% plot(x(1:5:end),u_dmd1(1:5:end,81),'ro','Markersize',3);
% plot(x(1:5:end),u_dmd4(1:5:end,81),'rx','Markersize',3);
% xlabel('$x$','FontUnits','points','interpreter','latex',...
%     'FontSize',10);
% ylabel('$u$','FontUnits','points','interpreter','latex',...
%     'FontSize',10);
% legend({'t = 0.4 reference','t = 0.4 DMD','t = 0.4 xDMD','t = 0.8 reference','t = 0.8 DMD','t = 0.8 xDMD'},...
%     'FontUnits','points','interpreter','latex','FontSize',10,'Location','Best');
% legend('boxoff') 
% title('Representation','FontUnits','points','interpreter','latex',...
%     'FontSize',10);

% figure
% width = 3.3;     % Width in inches
% height = 2.2;    % Height in inches
% set(gcf,'InvertHardcopy','on');
% set(gcf,'PaperUnits', 'inches');
% papersize = get(gcf, 'PaperSize');
% left = (papersize(1)- width)/2;
% bottom = (papersize(2)- height)/2;
% myfiguresize = [left, bottom, width, height];
% set(gcf,'PaperPosition', myfiguresize);
% plot(x,x,'r-','LineWidth',1);
% hold on;
% plot(x,Am1(:,end)/dt,'b--','LineWidth',1);
% plot(x,Am2(:,end)/dt,'k-.','LineWidth',1);
% xlabel('$x$','FontUnits','points','interpreter','latex',...
%     'FontSize',10);
% ylabel('$S$','FontUnits','points','interpreter','latex',...
%     'FontSize',10);
% legend({'$S = x$','gDMD bias','xDMD bias'},...
%     'FontUnits','points','interpreter','latex','FontSize',10,'Location','Best');
% legend('boxoff') 
% title('Source approximation','FontUnits','points','interpreter','latex',...
%     'FontSize',10);
% 
% figure
% width = 3.3;     % Width in inches
% height = 2.2;    % Height in inches
% set(gcf,'InvertHardcopy','on');
% set(gcf,'PaperUnits', 'inches');
% papersize = get(gcf, 'PaperSize');
% left = (papersize(1)- width)/2;
% bottom = (papersize(2)- height)/2;
% myfiguresize = [left, bottom, width, height];
% set(gcf,'PaperPosition', myfiguresize);
% hold on;
% plot(x,log10(abs(x-Am1(:,end)/dt)./abs(x)),'b--','LineWidth',1);
% plot(x,log10(abs(x-Am2(:,end)/dt)./abs(x)),'k-.','LineWidth',1);
% xlabel('$x$','FontUnits','points','interpreter','latex',...
%     'FontSize',10);
% ylabel('log relative error','FontUnits','points','interpreter','latex',...
%     'FontSize',10);
% legend({'gDMD bias','xDMD bias'},...
%     'FontUnits','points','interpreter','latex','FontSize',10,'Location','Best');
% legend('boxoff') 
% title('Source approximation error','FontUnits','points','interpreter','latex',...
%     'FontSize',10);


% %% extrapolation
% u_ex1 = 0*u_dmd1;
% u_ex2 = 0*u_dmd2;
% u_ex3 = 0*u_dmd3;
% u_ex4 = 0*u_dmd4;
% u_ex = 0*u;
% u_ex(:,1) = u(:,end);
% u_ex1(:,1) = u_dmd1(:,end);
% u_ex2(:,1) = u_dmd2(:,end);
% u_ex3(:,1) = u_dmd3(:,end);
% u_ex4(:,1) = u_dmd4(:,end);
% for n = 1:NT-1
%     u_ex1(:,n+1) = A_dmd1*u_ex1(:,n);
%     u_ex2(:,n+1) = u_ex2(:,n)+A_dmd2*u_ex2(:,n);
%     u_ex3(:,n+1) = Am1*[u_ex3(:,n);1];
%     u_ex4(:,n+1) = u_ex4(:,n)+Am2*[u_ex4(:,n);1];
%     u_ex(:,n+1) = A\(u_ex(:,n)+dt*x);
%     u_ex(1,n+1) = u_ex(2,n+1);
%     u_ex(NX,n+1) = u_ex(NX-1,n+1);
% end
% figure
% width = 3.3;     % Width in inches
% height = 2.2;    % Height in inches
% set(gcf,'InvertHardcopy','on');
% set(gcf,'PaperUnits', 'inches');
% papersize = get(gcf, 'PaperSize');
% left = (papersize(1)- width)/2;
% bottom = (papersize(2)- height)/2;
% myfiguresize = [left, bottom, width, height];
% set(gcf,'PaperPosition', myfiguresize);
% hold on;
% plot(t+0.8,log10(sum((u_ex-u_ex1).^2,1)./sum(u_ex.^2,1)),'k-','LineWidth',1);
% plot(t+0.8,log10(sum((u_ex-u_ex2).^2,1)./sum(u_ex.^2,1)),'g.','LineWidth',1);
% plot(t+0.8,log10(sum((u_ex-u_ex3).^2,1)./sum(u_ex.^2,1)),'b--','LineWidth',1);
% plot(t+0.8,log10(sum((u_ex-u_ex4).^2,1)./sum(u_ex.^2,1)),'r-.','LineWidth',1);
% xlabel('$t$','FontUnits','points','interpreter','latex',...
%     'FontSize',10);
% ylabel('log relative error','FontUnits','points','interpreter','latex',...
%     'FontSize',10);
% legend({'DMD','rDMD','gDMD','xDMD'},'FontUnits','points','interpreter','latex',...
%     'FontSize',10,'Location','Best');
% legend('boxoff') 
% title('Extrapolation Error','FontUnits','points','interpreter','latex',...
%     'FontSize',10);
% ylim([-17,-2])
% 
% figure
% width = 3.3;     % Width in inches
% height = 2.2;    % Height in inches
% set(gcf,'InvertHardcopy','on');
% set(gcf,'PaperUnits', 'inches');
% papersize = get(gcf, 'PaperSize');
% left = (papersize(1)- width)/2;
% bottom = (papersize(2)- height)/2;
% myfiguresize = [left, bottom, width, height];
% set(gcf,'PaperPosition', myfiguresize);
% hold on;
% plot(x,u_ex(:,41),'b-','LineWidth',1);
% plot(x(1:5:end),u_ex1(1:5:end,41),'bo','Markersize',3);
% plot(x(1:5:end),u_ex4(1:5:end,41),'bx','Markersize',3);
% plot(x,u_ex(:,81),'r-','LineWidth',1);
% plot(x(1:5:end),u_ex1(1:5:end,81),'ro','Markersize',3);
% plot(x(1:5:end),u_ex4(1:5:end,81),'rx','Markersize',3);
% xlabel('$x$','FontUnits','points','interpreter','latex',...
%     'FontSize',10);
% ylabel('$u$','FontUnits','points','interpreter','latex',...
%     'FontSize',10);
% legend({'t = 1.2 reference','t = 1.2 DMD','t = 1.2 xDMD','t = 1.6 reference','t = 1.6 DMD','t = 1.6 xDMD'},...
%     'FontUnits','points','interpreter','latex','FontSize',10,'Location','Best');
% legend('boxoff') 
% title('Extrapolation','FontUnits','points','interpreter','latex',...
%     'FontSize',10);
% ylim([1.75,4]);
% 
% 
% %% interpolation
% %%DMD use psedo inverse
% s = 9;
% rng(s);
% index1 = randperm(79,19);
% index1 = sort(index1)+1;
% index2 = index1+1;
% 
% X1 = [u(:,1),u(:,index1)];
% X2 = [u(:,2),u(:,index2)];
% 
% %% DMD
% A_dmd1 = X2*pinv(X1);
% u_in1 = 0*u;
% u_in1(:,1) = u(:,1);
% for n = 1:NT-1
%     u_in1(:,n+1) = A_dmd1*u_in1(:,n);
% end
% 
% %% DMD-id
% A_dmd2 = (X2-X1)*pinv(X1);
% u_in2 = 0*u;
% u_in2(:,1) = u(:,1);
% for n = 1:NT-1
%     u_in2(:,n+1) = u_in2(:,n)+A_dmd2*u_in2(:,n);
% end
% 
% %% mDMD
% X1_tilde = [X1;ones(1,length(index1)+1)];
% % X1_tilde(1,:) = 0; X1_tilde(end-1,:) = 0;
% X2_tilde = X2;
% A_dmd3 = X2_tilde*pinv(X1_tilde);
% 
% u_in3 = 0*u;
% u_in3(:,1) = u(:,1);
% 
% for n = 1:NT-1
%     u_in3(:,n+1) = A_dmd3*[u_in3(:,n);1];
% end
% 
% %% mDMD-id
% A_dmd4 = (X2_tilde-X1)*pinv(X1_tilde);
% 
% u_in4 = 0*u;
% u_in4(:,1) = u(:,1);
% 
% for n = 1:NT-1
%     u_in4(:,n+1) = u_in4(:,n)+A_dmd4*[u_in4(:,n);1];
% end
% 
% figure
% width = 3.3;     % Width in inches
% height = 2.2;    % Height in inches
% set(gcf,'InvertHardcopy','on');
% set(gcf,'PaperUnits', 'inches');
% papersize = get(gcf, 'PaperSize');
% left = (papersize(1)- width)/2;
% bottom = (papersize(2)- height)/2;
% myfiguresize = [left, bottom, width, height];
% set(gcf,'PaperPosition', myfiguresize);
% hold on;
% plot(t,log10(sum((u-u_in1).^2,1)./sum(u.^2,1)),'k-','LineWidth',1);
% plot(t,log10(sum((u-u_in2).^2,1)./sum(u.^2,1)),'g.','LineWidth',1);
% plot(t,log10(sum((u-u_in3).^2,1)./sum(u.^2,1)),'b--','LineWidth',1);
% plot(t,log10(sum((u-u_in4).^2,1)./sum(u.^2,1)),'r-.','LineWidth',1);
% xlabel('$t$','FontUnits','points','interpreter','latex',...
%     'FontSize',10);
% ylabel('log relative error','FontUnits','points','interpreter','latex',...
%     'FontSize',10);
% legend({'DMD','rDMD','gDMD','xDMD'},'FontUnits','points','interpreter','latex',...
%     'FontSize',10,'Location','Best');
% legend('boxoff') 
% title('Interpolation Error','FontUnits','points','interpreter','latex',...
%     'FontSize',10);
% ylim([-17,-2])
% 
% figure
% width = 3.3;     % Width in inches
% height = 2.2;    % Height in inches
% set(gcf,'InvertHardcopy','on');
% set(gcf,'PaperUnits', 'inches');
% papersize = get(gcf, 'PaperSize');
% left = (papersize(1)- width)/2;
% bottom = (papersize(2)- height)/2;
% myfiguresize = [left, bottom, width, height];
% set(gcf,'PaperPosition', myfiguresize);
% hold on;
% plot(x,u(:,41),'b-','LineWidth',1);
% plot(x(1:5:end),u_in1(1:5:end,41),'bo','Markersize',3);
% plot(x(1:5:end),u_in4(1:5:end,41),'bx','Markersize',3);
% plot(x,u(:,81),'r-','LineWidth',1);
% plot(x(1:5:end),u_in1(1:5:end,81),'ro','Markersize',3);
% plot(x(1:5:end),u_in4(1:5:end,81),'rx','Markersize',3);
% xlabel('$x$','FontUnits','points','interpreter','latex',...
%     'FontSize',10);
% ylabel('$u$','FontUnits','points','interpreter','latex',...
%     'FontSize',10);
% legend({'t = 0.4 reference','t = 0.4 DMD','t = 0.4 xDMD','t = 0.8 reference','t = 0.8 DMD','t = 0.8 xDMD'},...
%     'FontUnits','points','interpreter','latex','FontSize',11,'Location','Best');
% legend('boxoff') 
% title('Interpolation','FontUnits','points','interpreter','latex',...
%     'FontSize',10);

